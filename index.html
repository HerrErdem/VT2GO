<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online-Rechner: Leitungsdimensionierung</title>

  <!-- MathJax für Formeln -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']] },
      options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    :root{
      --bg:#070b16;
      --panel: rgba(255,255,255,.04);
      --card: rgba(255,255,255,.035);
      --line: rgba(255,255,255,.10);
      --text:#eaf1ff;
      --muted:#b9c7e6;
      --accent:#6aa6ff;
      --accent2:#7ef0c4;
      --shadow: 0 12px 34px rgba(0,0,0,.42);
      --radius: 18px;
      --danger: rgba(255,120,120,.18);
      --ok: rgba(126,240,196,.12);
      --warn: rgba(255,196,120,.14);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      line-height:1.6;
      background:
        radial-gradient(1100px 520px at 12% -8%, rgba(106,166,255,.25), transparent 55%),
        radial-gradient(900px 520px at 92% 0%, rgba(126,240,196,.18), transparent 55%),
        linear-gradient(180deg, var(--bg), #040611 72%);
    }

    .wrap{ max-width: 1040px; margin: 0 auto; padding: 26px 18px 64px; }

    header{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px;
      backdrop-filter: blur(7px);
      margin-bottom: 14px;
    }
    .top{ display:flex; gap:14px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:46px;height:46px;border-radius: 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 14px 30px rgba(106,166,255,.22);
      flex: 0 0 auto;
    }
    h1{ margin:0; font-size: 22px; font-weight: 700; letter-spacing: .2px; }
    .claim{ margin:4px 0 0; color: var(--muted); font-size: 13px; font-weight: 400; max-width: 70ch; }

    section{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px;
    }

    h2{ margin:0 0 10px; font-size: 18px; font-weight: 700; }
    h3{ margin:14px 0 8px; font-size: 15px; font-weight: 700; }

    .muted{ color: var(--muted); font-size: 14px; font-weight: 400; }

    /* Rechner UI */
    .formgrid{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr 1fr 1fr;
    }
    @media (max-width: 860px){ .formgrid{ grid-template-columns: 1fr; } }

    .field{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 12px 12px;
    }
    .field label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin:0 0 6px;
    }
    .field input, .field select{
      width:100%;
      padding: 10px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.22);
      color: var(--text);
      font-size: 14px;
      outline:none;
    }

    .actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px; }
    .action-btn{
      cursor:pointer;
      padding: 10px 14px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-size: 13px;
      font-weight: 400;
    }
    .action-btn:hover{ background: rgba(255,255,255,.07); }

    .resultgrid{
      display:grid;
      gap:12px;
      grid-template-columns: 1.2fr .8fr;
      margin-top: 12px;
    }
    @media (max-width: 860px){ .resultgrid{ grid-template-columns: 1fr; } }

    .status{
      border-radius: 16px;
      padding: 12px 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .status.ok{ background: var(--ok); border-color: rgba(126,240,196,.35); }
    .status.warn{ background: var(--warn); border-color: rgba(255,196,120,.35); }
    .status.bad{ background: var(--danger); border-color: rgba(255,120,120,.35); }

    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .small{ font-size: 12px; color: var(--muted); }
    .hr{ height:1px; background: rgba(255,255,255,.10); margin: 12px 0; border:0; }

    .formula{
      background: rgba(0,0,0,.25);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 12px;
      margin: 12px 0;
      overflow-x:auto;
    }

    .tablelike{
      border:1px solid var(--line);
      border-radius: 14px;
      overflow:hidden;
    }
    .tablelike .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      background: rgba(255,255,255,.02);
      border-top:1px solid rgba(255,255,255,.06);
    }
    .tablelike .row:first-child{ border-top:0; }
    .tablelike .k{ color: var(--muted); font-size: 12px; }
    .tablelike .v{ color: var(--text); font-size: 13px; }

    footer{ margin-top: 14px; text-align:center; color: var(--muted); font-size: 13px; font-weight: 400; }
  </style>
</head>

<body>
  <div class="wrap">

    <header>
      <div class="top">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>Online-Rechner: Leitungsdimensionierung</h1>
            <p class="claim">Berechnung von Betriebsstrom, erforderlichem Querschnitt (mit Korrekturfaktoren) und Spannungsfall.</p>
          </div>
        </div>
      </div>
    </header>

    <section id="rechner">
      <h2>Rechner</h2>
      <p class="muted">
        Bitte Werte eingeben und „Berechnen“ klicken. Der Rechner wählt den Querschnitt so, dass
        die Strombelastbarkeit (mit Faktoren) und der Spannungsfall geprüft werden können.
      </p>

      <div class="formgrid">
        <div class="field">
          <label>System</label>
          <select id="sys">
            <option value="1p" selected>Wechselstrom 1~</option>
            <option value="3p">Drehstrom 3~</option>
            <option value="dc">Gleichstrom ⎓</option>
          </select>
        </div>

        <div class="field">
          <label>Anzahl Verbraucher</label>
          <input id="nLoad" type="number" min="1" step="1" placeholder="z. B. 2">
        </div>

        <div class="field">
          <label>Wirkleistung je Verbraucher \(P\) in W</label>
          <input id="pEach" type="number" min="0" step="1" placeholder="z. B. 1250">
        </div>

        <div class="field">
          <label>Spannung \(U\) in V</label>
          <input id="u" type="number" min="1" step="1" placeholder="z. B. 230">
        </div>

        <div class="field">
          <label>Leistungsfaktor \(\cos\varphi\)</label>
          <input id="cosphi" type="number" min="0" max="1" step="0.01" placeholder="z. B. 0.9">
        </div>

        <div class="field">
          <label>Leitungslänge \(l\) (einfache Strecke) in m</label>
          <input id="len" type="number" min="0" step="0.1" placeholder="z. B. 40">
        </div>

        <div class="field">
          <label>Sicherung / Schutzorgan \(I_N\)</label>
          <select id="InSelect">
            <option value="" selected>Bitte auswählen…</option>
            <option value="auto">Auto (nächstgrößer ≥ \(I_B\))</option>
            <option value="6">6 A</option>
            <option value="10">10 A</option>
            <option value="13">13 A</option>
            <option value="16">16 A</option>
            <option value="20">20 A</option>
            <option value="25">25 A</option>
            <option value="32">32 A</option>
            <option value="40">40 A</option>
            <option value="50">50 A</option>
            <option value="63">63 A</option>
          </select>
        </div>

        <div class="field">
          <label>Zulässiger Spannungsfall \(\Delta u_{\max}\) in %</label>
          <input id="duMax" type="number" min="0" step="0.1" placeholder="z. B. 5">
        </div>

        <div class="field">
          <label>Leitungstabelle</label>
          <select id="tableType">
            <option value="" selected>Bitte auswählen…</option>
            <option value="hh">Flexible Leitungen – Haus/Handgeräte</option>
            <option value="other">Flexible Leitungen – alle anderen Anwendungen</option>
          </select>
        </div>

        <div class="field">
          <label>Belastete Adern</label>
          <select id="cores">
            <option value="" selected>Bitte auswählen…</option>
            <option value="2">2 (L + N)</option>
            <option value="3">3 (L1 + L2 + L3)</option>
          </select>
        </div>

        <div class="field">
          <label>Isolierstoff</label>
          <select id="insul">
            <option value="" selected>Bitte auswählen…</option>
            <option value="gummi60">Gummi (60 °C)</option>
            <option value="pvc70">PVC/PE (70 °C)</option>
          </select>
        </div>

        <div class="field">
          <label>Umgebungstemperatur</label>
          <select id="temp">
            <option value="" selected>Bitte auswählen…</option>
            <option value="20">20 °C</option>
            <option value="30">30 °C</option>
            <option value="35">35 °C</option>
            <option value="40">40 °C</option>
            <option value="45">45 °C</option>
            <option value="50">50 °C</option>
          </select>
        </div>

        <div class="field">
          <label>Häufung (Fußboden/Wand)</label>
          <select id="haufType">
            <option value="" selected>Bitte auswählen…</option>
            <option value="einlagig">einlagig</option>
            <option value="gebuendelt">gebündelt</option>
          </select>
        </div>

        <div class="field">
          <label>Anzahl parallel verlegter Leitungen (1–10)</label>
          <input id="haufN" type="number" min="1" max="10" step="1" placeholder="z. B. 3">
        </div>

        <div class="field">
          <label>Trommelbetrieb: Anzahl Lagen</label>
          <select id="layers">
            <option value="" selected>Bitte auswählen…</option>
            <option value="0">keine / vollständig abgerollt</option>
            <option value="1">1 Lage</option>
            <option value="2">2 Lagen</option>
            <option value="3">3 Lagen</option>
            <option value="4">4 Lagen</option>
            <option value="5">5 Lagen</option>
          </select>
        </div>

        <div class="field">
          <label>Leitermaterial (für \(\kappa\))</label>
          <select id="material">
            <option value="" selected>Bitte auswählen…</option>
            <option value="cu57">Kupfer (E-Cu) \(\kappa = 57\)</option>
            <option value="al3597">Aluminium \(\kappa = 35{,}97\)</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="action-btn" id="btnCalc">Berechnen</button>
        <button class="action-btn" id="btnClear">Eingaben leeren</button>
      </div>

      <div class="resultgrid">
        <div>
          <div id="statusBox" class="status">
            <h3 style="margin:0 0 6px;">Ergebnis</h3>
            <div class="small" id="statusText">Noch keine Berechnung.</div>
          </div>

          <div class="hr"></div>

          <h3>Rechenweg</h3>
          <div id="steps" class="formula">
            <span class="muted">Nach „Berechnen“ erscheint hier der Rechenweg.</span>
          </div>
        </div>

        <div>
          <h3>Kurzwerte</h3>
          <div class="tablelike">
            <div class="row"><div class="k">Betriebsstrom \(I_B\)</div><div class="v mono" id="qIb">–</div></div>
            <div class="row"><div class="k">Schutz \(I_N\)</div><div class="v mono" id="qIn">–</div></div>
            <div class="row"><div class="k">Faktorprodukt \(f\)</div><div class="v mono" id="qF">–</div></div>
            <div class="row"><div class="k">Erforderlich \(I_r\)</div><div class="v mono" id="qIr">–</div></div>
            <div class="row"><div class="k">Querschnitt \(A\)</div><div class="v mono" id="qA">–</div></div>
            <div class="row"><div class="k">Spannungsfall \(\Delta u\)</div><div class="v mono" id="qDu">–</div></div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      Online-Rechner – Leitungsdimensionierung
    </footer>

  </div>

  <script>
    // ============================
    // Tabellen / Faktoren
    // ============================

    const IN_STEPS = [6,10,13,16,20,25,32,40,50,63];

    const TEMP_FACTORS_GUMMI60 = {20:1.15, 30:1.00, 35:0.91, 40:0.82, 45:0.71, 50:0.58};
    const TEMP_FACTORS_PVC70   = {20:1.12, 30:1.00, 35:0.94, 40:0.87, 45:0.79, 50:0.71};

    const HAUF_EINLAGIG = {1:1.00,2:0.85,3:0.79,4:0.75,5:0.73,6:0.72,7:0.72,8:0.71,9:0.70,10:0.70};
    const HAUF_GEBUENDELT = {1:1.00,2:0.80,3:0.70,4:0.65,5:0.60,6:0.57,7:0.54,8:0.52,9:0.50,10:0.48};

    const TROMMEL = {0:1.00, 1:0.80, 2:0.61, 3:0.49, 4:0.42, 5:0.38};

    // Strombelastbarkeit (Referenz: Umgebung 30°C, Verlegung auf/an Flächen)
    const IZ_TABLES = {
      hh: {
        "2": {0.75:6, 1:10, 1.5:16, 2.5:25, 4:32, 6:40, 10:63},
        "3": {0.75:6, 1:10, 1.5:16, 2.5:20, 4:25}
      },
      other: {
        "2": {0.75:12, 1:15, 1.5:18, 2.5:26, 4:34, 6:44, 10:61, 16:82, 25:108, 35:135, 50:168},
        "3": {0.75:12, 1:15, 1.5:18, 2.5:26, 4:34, 6:44, 10:61, 16:82, 25:108, 35:135, 50:168}
      }
    };

    const el = (id)=>document.getElementById(id);
    const round2 = (x)=>Math.round(x*100)/100;
    const round3 = (x)=>Math.round(x*1000)/1000;

    function getTempFactor(insul, temp){
      const t = Number(temp);
      if(insul === "gummi60") return TEMP_FACTORS_GUMMI60[t] ?? null;
      if(insul === "pvc70") return TEMP_FACTORS_PVC70[t] ?? null;
      return null;
    }

    function getHaufFactor(type, n){
      const nn = Math.max(1, Math.min(10, Number(n)));
      if(type === "einlagig") return HAUF_EINLAGIG[nn] ?? null;
      if(type === "gebuendelt") return HAUF_GEBUENDELT[nn] ?? null;
      return null;
    }

    function nextInStep(ib){
      for(const s of IN_STEPS){
        if(s >= ib) return s;
      }
      return IN_STEPS[IN_STEPS.length-1];
    }

    function pickCrossSection(tableKey, cores, requiredIr){
      const table = IZ_TABLES[tableKey]?.[String(cores)];
      if(!table) return {A:null, Ir:null, note:"Für diese Tabellenwahl sind keine Werte hinterlegt."};

      const entries = Object.entries(table)
        .map(([A, Ir]) => ({A:Number(A), Ir:Number(Ir)}))
        .sort((a,b)=>a.A-b.A);

      for(const e of entries){
        if(e.Ir >= requiredIr) return {A:e.A, Ir:e.Ir, note:""};
      }
      return {A:null, Ir:null, note:"Kein Querschnitt in dieser Tabelle erfüllt die Anforderung."};
    }

    function computeIb(sys, Pges, U, cosphi){
      if(sys === "dc") return Pges / U;
      if(sys === "3p") return Pges / (Math.sqrt(3)*U*cosphi);
      return Pges / (U*cosphi);
    }

    function computeDeltaU(sys, l, I, cosphi, kappa, A){
      if(A <= 0) return NaN;
      if(sys === "dc") return (2*l*I) / (kappa*A);
      if(sys === "3p") return (Math.sqrt(3)*l*I*cosphi) / (kappa*A);
      return (2*l*I*cosphi) / (kappa*A);
    }

    function setStatus(kind, text, detail){
      const box = el("statusBox");
      box.classList.remove("ok","warn","bad");
      if(kind === "ok") box.classList.add("ok");
      else if(kind === "warn") box.classList.add("warn");
      else if(kind === "bad") box.classList.add("bad");
      el("statusText").innerHTML = `<div>${text}</div>${detail ? `<div class="small" style="margin-top:6px;">${detail}</div>` : ""}`;
    }

    function clearInputs(){
      ["nLoad","pEach","u","cosphi","len","duMax","haufN"].forEach(id=>el(id).value="");

      ["InSelect","tableType","cores","insul","temp","haufType","layers","material"].forEach(id=>{
        if(el(id)) el(id).value = "";
      });

      el("sys").value = "1p";

      setStatus("status", "Noch keine Berechnung.", "");
      el("steps").innerHTML = '<span class="muted">Nach „Berechnen“ erscheint hier der Rechenweg.</span>';
      ["qIb","qIn","qF","qIr","qA","qDu"].forEach(id=>el(id).textContent="–");

      if(window.MathJax) MathJax.typesetPromise();
    }

    function validateRequired(){
      const missing = [];

      const nLoad = el("nLoad").value.trim();
      const pEach = el("pEach").value.trim();
      const U = el("u").value.trim();
      const cosphi = el("cosphi").value.trim();
      const len = el("len").value.trim();
      const InSel = el("InSelect").value;
      const duMax = el("duMax").value.trim();
      const tableType = el("tableType").value;
      const cores = el("cores").value;
      const insul = el("insul").value;
      const temp = el("temp").value;
      const haufType = el("haufType").value;
      const haufN = el("haufN").value.trim();
      const layers = el("layers").value;
      const material = el("material").value;

      if(!nLoad) missing.push("Anzahl Verbraucher");
      if(!pEach) missing.push("Wirkleistung je Verbraucher");
      if(!U) missing.push("Spannung U");
      if(!cosphi) missing.push("cos φ");
      if(!len) missing.push("Leitungslänge l");
      if(!InSel) missing.push("Sicherung I_N");
      if(!duMax) missing.push("zulässiger Spannungsfall Δu_max");
      if(!tableType) missing.push("Leitungstabelle");
      if(!cores) missing.push("belastete Adern");
      if(!insul) missing.push("Isolierstoff");
      if(!temp) missing.push("Umgebungstemperatur");
      if(!haufType) missing.push("Häufung (Art)");
      if(!haufN) missing.push("Häufung (Anzahl Leitungen)");
      if(!layers) missing.push("Trommelbetrieb (Lagen)");
      if(!material) missing.push("Leitermaterial");

      return missing;
    }

    function calc(){
      const missing = validateRequired();
      if(missing.length){
        setStatus("bad", "Eingaben unvollständig.", "Bitte ergänzen: " + missing.join(", "));
        return;
      }

      const sys = el("sys").value;

      const nLoad = Number(el("nLoad").value);
      const pEach = Number(el("pEach").value);
      const U = Number(el("u").value);
      const cosphi = Number(el("cosphi").value);
      const l = Number(el("len").value);

      const InSelect = el("InSelect").value;
      const duMax = Number(el("duMax").value);

      const tableType = el("tableType").value;
      const cores = Number(el("cores").value);

      const insul = el("insul").value;
      const temp = Number(el("temp").value);

      const haufType = el("haufType").value;
      const haufN = Number(el("haufN").value);

      const layers = Number(el("layers").value);
      const material = el("material").value;

      const kappa = (material === "al3597") ? 35.97 : 57;

      // 1) Leistung + Betriebsstrom
      const Pges = nLoad * pEach;
      const Ib = computeIb(sys, Pges, U, cosphi);

      // 2) I_N
      let In;
      let InExplain = "";
      if(InSelect === "auto"){
        In = nextInStep(Ib);
        InExplain = "Auto (nächstgrößer ≥ I_B)";
      } else {
        In = Number(InSelect);
        InExplain = "manuell gewählt";
      }

      // 3) Faktoren
      const fT = getTempFactor(insul, temp);
      const fH = getHaufFactor(haufType, haufN);
      const fTr = TROMMEL[layers] ?? null;

      if(fT === null || fH === null || fTr === null){
        setStatus("bad", "Faktoren konnten nicht bestimmt werden.", "Bitte prüfe Temperatur/Häufung/Trommel-Eingaben.");
        return;
      }

      const f = fT * fH * fTr;

      // 4) Erforderliche Tabellen-Strombelastbarkeit
      const IrReq = In / f;

      // 5) Querschnitt aus Tabelle
      const pick = pickCrossSection(tableType, cores, IrReq);

      // 6) Spannungsfall
      let dU = NaN, du = NaN;
      if(pick.A){
        dU = computeDeltaU(sys, l, Ib, cosphi, kappa, pick.A);
        du = (dU / U) * 100;
      }

      // Outputs
      el("qIb").textContent = `${round2(Ib)} A`;
      el("qIn").textContent = `${In} A (${InExplain})`;
      el("qF").textContent = `${round3(f)} (= ${round2(fT)} · ${round2(fH)} · ${round2(fTr)})`;
      el("qIr").textContent = `${round2(IrReq)} A`;
      el("qA").textContent = pick.A ? `${pick.A} mm² (I_r=${pick.Ir} A)` : `–`;
      el("qDu").textContent = pick.A ? `${round2(du)} % (ΔU=${round2(dU)} V)` : `–`;

      const nennstromOk = Ib <= In;
      const querschnittOk = pick.A !== null;
      const spannungsOk = (pick.A !== null) ? (du <= duMax) : false;

      const formulaIb = (sys==="dc")
        ? `I_B=\\frac{P_{ges}}{U}`
        : (sys==="3p")
          ? `I_B=\\frac{P_{ges}}{\\sqrt{3}\\,U\\,\\cos\\varphi}`
          : `I_B=\\frac{P_{ges}}{U\\,\\cos\\varphi}`;

      const duFormula = (sys==="dc")
        ? `\\Delta U=\\frac{2\\,l\\,I}{\\kappa\\,A}`
        : (sys==="3p")
          ? `\\Delta U=\\frac{\\sqrt{3}\\,l\\,I\\,\\cos\\varphi}{\\kappa\\,A}`
          : `\\Delta U=\\frac{2\\,l\\,I\\,\\cos\\varphi}{\\kappa\\,A}`;

      el("steps").innerHTML = `
        <div class="small">1) Gesamtwirkleistung</div>
        <div class="mono">Pges = ${nLoad} · ${pEach} W = ${Pges} W</div>

        <hr class="hr">
        <div class="small">2) Betriebsstrom</div>
        <div>$$ ${formulaIb} $$</div>
        <div class="mono">I_B = ${round2(Ib)} A</div>

        <hr class="hr">
        <div class="small">3) Sicherung / Schutzorgan</div>
        <div>$$ I_B \\le I_N $$</div>
        <div class="mono">I_N = ${In} A (${InExplain})</div>
        <div class="mono">${nennstromOk ? "OK" : "NICHT OK"}: ${round2(Ib)} ≤ ${In}</div>

        <hr class="hr">
        <div class="small">4) Korrekturfaktoren</div>
        <div class="mono">f_T = ${fT} | f_H = ${fH} | f_Tr = ${fTr}</div>
        <div>$$ f = f_T\\cdot f_H\\cdot f_{Tr} = ${round3(f)} $$</div>

        <hr class="hr">
        <div class="small">5) Erforderlicher Tabellenwert</div>
        <div>$$ I_Z = I_r\\cdot f \\Rightarrow I_r \\ge \\frac{I_N}{f} $$</div>
        <div class="mono">I_r,erf = ${In} / ${round3(f)} = ${round2(IrReq)} A</div>

        <hr class="hr">
        <div class="small">6) Querschnittsauswahl</div>
        <div class="mono">
          ${pick.A ? `A = ${pick.A} mm² (I_r=${pick.Ir} A) ≥ ${round2(IrReq)} A` : `Keine passende Auswahl. ${pick.note}`}
        </div>

        <hr class="hr">
        <div class="small">7) Spannungsfall</div>
        <div class="mono">κ = ${kappa} m/(Ω·mm²)</div>
        <div>$$ ${duFormula} $$</div>
        ${pick.A ? `
          <div class="mono">ΔU = ${round2(dU)} V</div>
          <div>$$ \\Delta u = \\frac{\\Delta U}{U}\\cdot 100\\% $$</div>
          <div class="mono">Δu = ${round2(du)} %  (Grenze: ${duMax} %)</div>
        ` : `<div class="mono">Spannungsfall nicht berechnet (kein Querschnitt).</div>`}
      `;

      if(!nennstromOk){
        setStatus("bad", "Nennstromregel verletzt: Sicherung zu klein.", "Wähle eine höhere Sicherungsstufe oder reduziere die Last.");
      } else if(!querschnittOk){
        setStatus("bad", "Kein Querschnitt gefunden (Strombelastbarkeit).", "Wähle andere Tabellenannahmen oder erhöhe Querschnitt außerhalb der Tabelle.");
      } else if(!spannungsOk){
        setStatus("warn", "Strombelastbarkeit OK, aber Spannungsfall zu hoch.", "Querschnitt erhöhen oder Leitungslänge reduzieren.");
      } else {
        setStatus("ok", "Dimensionierung OK.", `Ergebnis: ${pick.A} mm² bei Δu=${round2(du)} %.`);
      }

      if(window.MathJax) MathJax.typesetPromise();
    }

    el("btnCalc").addEventListener("click", calc);
    el("btnClear").addEventListener("click", clearInputs);
  </script>

</body>
</html>
